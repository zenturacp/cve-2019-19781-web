<?php

function updateCounter($file) {
    if (file_exists($file)) {
        $counter = intval(file_get_contents($file));
        $counter += 1;    
    } else {
        $counter = 1;
    }
    file_put_contents($file, $counter);
    return $counter;
}

?>

<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Netscaler cve-2019-19781 Scanner</title>
</head>

<body>
    <div class=container>
        <h1>This is just a quick and dirty scanner to scan for<br>
            Citrix <a href=https://support.citrix.com/article/CTX267027>CVE-2019-19781 </a> </h1> 
                <form action=/scan.php method="post">
                <div class="form-group">
                    <label for="inputHost">IP Address / FQDN</label>
                    <input type="host" class="form-control" name="inputHost" id="inputHost" aria-describedby="hostHelp" placeholder="Type IP / Hostname">
                    <small id="hostHelp" class="form-text text-muted">Please type in the IP / Hostname of the server to
                        check</small>
                </div>
                <button type="submit" class="btn btn-primary">Scan Host</button>
                </form>
                <p>
                <h2>Check if wildcard cert was leaked due to CVE-2019-19781</h2>
                <form action=/wildcard.php method="post">
                <div class="form-group">
                    <label for="inputDomain">Enter domain name ONLY like example.com then we will match for *.example.com</label>
                    <input type="host" class="form-control" name="inputDomain" id="inputDomain" aria-describedby="hostHelp" placeholder="ex. example.com to search for *.example.com">
                    <small id="hostHelp" class="form-text text-muted">Enter domain name</small>
                </div>
                <button type="submit" class="btn btn-primary">Lookup domain</button>
                </form>
                <p>
                    <h3>Credits</h3>
                    This project is based on <a href=https://github.com/trustedsec/cve-2019-19781>TrustedSec</a> PoC code - modified and put into a webinterface for easy access.
                </p>
                <p>
                    <h3>Who - Me?</h3>
                    Christian Pedersen christian.pedersen(a)zentura.dk - Twitter: @zentura_cp
                </p>
                <p>
                    Total page visits since January 28. 2020: <?php echo updateCounter("/var/www/counter/Visits.txt"); ?>
                </p>
    </div>
</body>

</html>